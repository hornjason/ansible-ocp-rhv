---
- name: oVirt infra
  hosts: localhost
  become: true
  connection: local
  gather_facts: false
  vars_files:
    - ../ocp-vars.yml
  tasks:
    - name: Log in to oVirt
      ovirt_auth:
        url: "{{ engine_url }}"
        username: "{{ engine_user }}"
        password: "{{ engine_password }}"
        ca_file: "{{ engine_cafile | default(omit) }}"
        insecure: "{{ engine_insecure | default(true) }}" 

    - name: gather vm facts
      ovirt_vm_facts:
        pattern:d cluster={{ rhv_cluster }}
    - debug:
        var: ovirt_vms
