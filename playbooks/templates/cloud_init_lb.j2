{% if admin_user is defined and admin_user != '' %}
users:
  - name: {{ admin_user }}
    sudo:  ALL=(ALL) NOPASSWD:ALL
    ssh_authorized_keys:
      - "{{ admin_ssh_key }}"
{% endif %}
runcmd:
  - touch /etc/sysconfig/.finished
{% if use_rhsm | bool %}
rh_subscription:
{% if rhsm_user is defined %}
  username: {{ rhsm_user }}
  password: {{ rhsm_pass }}
{% elif rhsm_master_key is defined %}
  activation-key: {{ rhsm_master_key }}
  org: {{ rhsm_master_org }}
{% endif %}
  add-pool: [{{ rhsm_broker_pool }}]
{% if rhsm_satellite is defined and rhsm_satellite != "" %}
  server-hostname: {{ rhsm_satellite }}
  rhsm-baseurl: {{ rhsm_satellite }}
{% endif %}
  disable-repo:
    - rhel-7-server-rt-rpms
    - rhel-7-server-nfv-rpms
    - rhel-7-server-aus-rpms
    - rhel-7-server-rt-rpms
    - rhel-7-server-tus-rpms
    - rhel-7-server-htb-rpms
  enable-repo:
{% if rhsm_repos is defined %}
{% for repo in rhsm_repos %}
    - {{ repo }}
{% endfor %}
{% else %}
    - rhel-7-server-rpms
    - rhel-7-server-exras-rpms
{% endif %}
{% else %} # if using custom yum repo server
yum_repos:
{{ lookup('template', 'templates/yum_repos.j2') | indent(0,false) }}
{% endif %} # end using rhsm

packages:
{% if pkgs is defined %}
{% for pkg in pkgs %}
  - {{ pkg }} 
{% endfor %}
{% endif %}
{% if idm_server is defined and idm_server != ''  %}
  - ipa-client
{% endif %}
  #- kernel
  - net-tools
  - bind-utils
  - iptables-services
  - bridge-utils
  - bash-completion
  - kexec-tools
  - sos
  - psacct
  - vim
package_update: true
package_upgrade: true
package_reboot_if_required: false
